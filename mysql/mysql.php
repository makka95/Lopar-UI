<?phpinclude "mysql_database.php";function validateform() {	$counter = 0;	if (isset($_POST['nickname']) && $_POST['nickname'] != null) {		$nickname = $_POST['nickname'];		$counter++;	}	else {		echo "Vänligen skriv in ett användarnamn<br>";	}	if (isset($_POST['password']) && $_POST['password'] != null) {		if ($_POST['password'] != $_POST['passwordupr'])		{			echo "Lösenorden matchar inte varandra<br>";		}		else{			$password = $_POST['password'];			$counter++;		}	}	else {		echo "Vänligen fyll i ett lösenord<br>";	}	if (isset($_POST['mail']) && $_POST['mail'] != null) {		if($_POST['mail'] != $_POST['mailupr']) {			echo "Mail addresserna matchar inte varandra";		}		else {			$mail = $_POST['mail'];			$counter++;		}	}	else {		echo "Vänligen fyll i din E-mail";	}	if (isset($_POST['namn']) && $_POST['namn'] != null) {		$namn = $_POST['namn'];		$counter++;	}	else {		echo "Vänligen fyll i ditt namn<br>";	}	if (isset($_POST['efternamn']) && $_POST['efternamn'] != null) {		$efternamn = $_POST['efternamn'];		$counter++;	}	else {		echo "Vänligen fyll i ditt efternamn<br>";	}	if (isset($_POST['gender']) && $_POST['gender'] != null) {		$gender = $_POST['gender'];		$counter++;	}	else {		echo "Vänligen välj ditt kön<br>";	}	if (isset($_POST['lan']) && $_POST['lan'] != null) {		$lan = $_POST['lan'];		$counter++;	}	else {		echo "Vänligen välj ditt län<br>";	}	if (isset($_POST['aktivitet']) && $_POST['aktivitet'] != null) {		$aktivitet = $_POST['aktivitet'];		$counter++;	}	else {		echo "Vänligen välj din aktivitetsgrad<br>";	}	if ($counter == 8) {		echo "Form Validated<br>";		$connection = connecttodatabase();		$password = md5($password);		$query = "INSERT INTO Anvandare (Nickname, Password, Fornamn, Efternamn, Kon, Lan, Aktivitetsgrad, Email) VALUES ('$nickname', '$password', '$namn', '$efternamn', '$gender', '$lan', '$aktivitet', '$mail')";		if($connection->query($query)) {			echo "gick bra";		}		else {			echo mysql_error();		}		closeconnection($connection);	}	else {		echo "Error<br>";	}}function logout() {	if(isset($_COOKIE['login'])) {		setcookie("login", null, time(), '/', 'localhost');	} }function getoptions() {	$hour = "0";	$min = "00";	while ($hour != "24") {		echo '<option value="';		echo $hour . ':';		echo $min;		echo '">';		echo $hour;		echo ':';		echo $min;		echo '</option>';		if ($min == "00") {			$min += 30;		}		else {			$min = "00";			$hour++;		}	}}function skapaaktivitet () {	if	($_GET['operation'] == "skapa") {		if (isset($_POST['year']) && $_POST['year'] != null && isset($_POST['month']) && $_POST['month'] != null && isset($_POST['day']) && $_POST['day'] != null) {			$year = $_POST['year'];			$month = $_POST['month'];			$day = $_POST['day'];			$date = $year . "-" . $month . "-" . $day;		}		else {			echo "Skriv in ett korrekt datum";		}		if (isset($_POST['namn']) && $_POST['namn'] != null) {			$namn = $_POST['namn'];		}		else {			echo "Skriv in ett namn på händelsen";		}		if (isset($_POST['tid']) && $_POST['tid'] != null) {			$tid = $_POST['tid'];		}		else {			echo "Välj en tid  för händelsen";		}		if (isset($_POST['visibility']) && $_POST['visibility'] != null) {			if($_POST['visibility'] == "alla") {				$visi = "A";			}			else {				$visi = "F";			}		}		else {			echo "Välj vilka medlemmar som händelsen skall vara synlig för";		}		if (isset($_COOKIE['login']) && $_COOKIE['login'] != null) {			$id = $_COOKIE['login'];		}		if (isset($_POST['plats']) && $_POST['plats'] != null) {			$plats = $_POST['plats'];		}		$date = $date . ' ' . $tid . ':00';		$connect = connecttodatabase();		$query = "INSERT INTO Events (Skapare, Namn, Plats, Synlighet, Date) VALUES ('$id', '$namn', '$plats', '$visi', '$date')";		if ($query_run = $connect->query($query)) {			$query = "SELECT ID FROM Events WHERE (Skapare=$id AND Namn='$namn' AND Date='$date')";			print $query;			$result = mysqli_fetch_assoc($connect->query($query));			set_har_notis ($connect, $id, $result['ID'], 1, 3) ;			send_notis ($connect, $id,$result['ID'] , 1, 3, "Det Har Just Skapats ett Event");		}		closeconnection($connect);	} else if ($_GET['operation'] == "change") {		$event_id = $_GET['evt'];		$date = "'" . $_POST['year'] . "-" . $_POST['month'] . "-" . $_POST['day']  . " " . $_POST['time'] . ":00'";		$query = "UPDATE Events SET Namn='" . $_POST['namn'] . "', Plats='" . $_POST['plats'] . "', Synlighet='" . $_POST['visibility'] . "', Date=" . $date . " WHERE ID=" . $event_id;		$connect = connecttodatabase();		if($connect->query($query)) {			send_notis ($connect, $_COOKIE['login'],$event_id , 1, 1, "Det Har Just Skett En ÄNdring I ett Event");		}		closeconnection($connect);	}}function get_date () {	$time = "";    if(isset($_GET['date'])) {		try {			if(strtotime($_GET['date'])){				$time = strtotime($_GET['date']);			} else {				throw new Exception("Error getting date");			}		} catch (Exception $e) {			$time = time();		}	} else {		$time = time();	}	echo '<select name="year">';	echo '<option value="' . date('Y', $time) . '">' . date('Y', $time) . '</option>';	echo '<option value="' . date('Y', $time + (365*24*60*60)) . '">' . date('Y', $time + (365*24*60*60)) . '</option>';	echo '<option value="' . date('Y', $time + (2*365*24*60*60)) . '">' . date('Y', $time + (2*365*24*60*60)) . '</option>';	echo '</select>';	echo '<select name="month">';	for($i = 1; $i<= 12; $i++) {		if ($i == date('n', $time)) {			echo '<option value="' . $i . '" selected>' . $i . '</option>';		} else {			echo '<option value="' . $i . '">' . $i . '</option>';		}	}	echo '</select>';	echo '<select name="day">';	for ($i = 1; $i <= 31; $i++) {		if ($i == date('j', $time)) {			echo '<option value="' . $i . '" selected>' . $i . '</option>';		} else {			echo '<option value="' . $i . '">' . $i . '</option>';		}	}    echo '</select>';}function getmonth() {	echo date('F', time());}function month_button() {	$time = 0;	$last = 0;	$next = 0;	if(isset($_GET['m']) && $_GET['m'] != "") {		$time = $_GET['m'];	} else {		$time = strtotime("first day of this month");	}	if(date('n',$time) >= 12){		$next = strtotime((string)(date('Y',$time)+1) . '-1-1');	} else {		$next = strtotime(date('Y',$time) . '-' . (string)(date('n',$time)+1) . '-1');	}	if(date('n',$time) <= 1) {		$last = strtotime((string)(date('Y',$time)-1) . '-12-1');	} else {		$last = strtotime(date('Y',$time) . '-' . (string)(date('n',$time)-1) . '-1');	}	echo '<div class="contain_month">';	echo '<a href="kalender.php?m=' . $last . '" class="left"></a>';	echo '<a href="kalender.php?m=' . $next . '" class="right"></a>';	echo '<h1 class="month">' . date('F',$time) . ' - ' . date('Y', $time) . '</h1>';	echo '</div>';}function createcalendar() {	/*Time -- Setup*/	$nextmonth_first = 0;	$lastmonth_first = 0;	$tid = 0;	$firstday_month = 0;	$day_week = 0;	$lastmonth = 0;	if(isset($_GET['m']) && $_GET['m'] != "") {		$tid = $_GET['m'];		$firstday_month = $tid;		if(date('n',$tid) >= 12){			$nextmonth_first = strtotime((date('Y',$tid)+1) . '-1-1');		} else {			$nextmonth_first = strtotime(date('Y',$tid) . '-' . (date('n',$tid)+1) . '-1');		}		$day_week = date('N',$firstday_month);		if(date('n',$tid) <= 1) {			$lastmonth_first = strtotime((date('Y',$tid)-1) . '-12-1');		} else {			$lastmonth_first = strtotime(date('Y',$tid) . '-' . (date('n',$tid)-1) . '-1');		}	} else {		$tid = time();		$firstday_month = strtotime("first day of this month");		$day_week = date('N',$firstday_month);		$lastmonth_first = strtotime("first day of previous month");		$nextmonth_first = strtotime("first day of next month");	}	$lastmonth = date('t',$lastmonth_first);	$tick = 1;	$row = 1;	print '<tr class="nummer">';	for ($i = 1; $i <= $day_week-1; $i++) {		$date = date('Y', $lastmonth_first) .  '-' . date('n', $lastmonth_first) . '-' . (string)($lastmonth-$day_week+$i);		print '<td class="lastmonth" id="' . $date . '">' . (string)($lastmonth-$day_week+$i) . '</td>';		if($tick >= 7) {			$tick = 1;			if ($row != 6) {				$row++;				print '</tr>';				print '<tr class="nummer">';			}		}else {			$tick++;		}	}	for ($i = 1; $i <= date('t', $tid); $i++) {		$date = date('Y', $tid) . '-' . date('n', $tid) . '-' . (string)$i;		print '<td id="' . $date . '">' . $i . '</td>';		if($tick >= 7) {			$tick = 1;			if ($row != 6) {				$row++;				print '</tr>';				print '<tr class="nummer">';			}		}else {			$tick++;		}	}	$days_left = 7-(date('N', strtotime(date('Y',$nextmonth_first) . '-' . date('n', $nextmonth_first) . '-1')))+1;	if($row != 6) {		$days_left += 7;	}	for ($i = 1; $i <= $days_left; $i++) {		$date = date('Y', $nextmonth_first) . '-' . date('n', $nextmonth_first) . '-' . (string)$i;		print '<td class="lastmonth" id="' . $date . '">' . $i . '</td>';		if($tick >= 7) {			$tick = 1;			if ($row != 6) {				$row++;				print '</tr>';				print '<tr class="nummer">';			}		}else {			$tick++;		}	}	print '</tr>';}function get_profil () {	$connect = connecttodatabase();	if (isset($_GET['nick']) && $_GET['nick'] != "") {		$query = "SELECT * FROM Anvandare WHERE Nickname='" . $_GET['nick'] . "'";		$result = mysqli_fetch_assoc($connect->query($query));		echo 'Profilbild:';		echo '<div class="bild">';		echo '<img class="profilbild" src="User-Prof/' . $result['ID'] . '-prof.jpg" alt="Profilbild" />';		echo '</div>';		echo 'Användarnamn: ' . $result['Nickname'] . '<br>';		echo 'Namn: ' . $result['Fornamn'] . ' ' . $result['Efternamn'] . '<br>';		echo 'Län: ' . $result['Lan'] . '<br>';		echo 'Aktivitetsgrad: ' . $result['Aktivitetsgrad'] . '<br>';		echo 'E-mail: ' . $result['Email'];		if ($_COOKIE['login'] != null) {			$query = "SELECT ID FROM Friends WHERE ((Friend_1=" . $_COOKIE['login'] . " AND Friend_2=" . $result['ID'] . ") OR (Friend_1=" . $result['ID'] . " AND Friend_2=" . $_COOKIE['login'] . "))";			if (mysqli_num_rows($connect->query($query)) == 0) {				$query = "SELECT Status FROM Friend_Request WHERE (Friend_1=" . $_COOKIE['login'] . " AND Friend_2=" . $result['ID'] . ")";				if (mysqli_num_rows($connect->query($query)) == 0) {					print '<form method="get" action="add_friend.php">';					print '<input type="hidden" name="id1" value="' . $_COOKIE['login'] . '">';					print '<input type="hidden" name="id2" value="' . $result['ID'] . '">';					print '<input type="submit" value="Skicka Vänförfrågan">';					print '</form>';				}			}		}	} else {		if ($_COOKIE['login'] != null) {					echo '<span class="user-nick">';			$id = $_COOKIE['login'];			$query = "SELECT Nickname FROM Anvandare WHERE ID=$id";			$query_run = $connect->query($query);			$query_result = mysqli_fetch_assoc($query_run);			echo $query_result['Nickname'] .  "</span>";									echo '<div class="user-bild">Profilbild:<br>';			echo '<div class="bild">';			echo '<img class="profilbild" src="User-Prof/' . $_COOKIE['login'] . '-prof.jpg" alt="Profilbild" />';			echo '</div>';						echo '<form action="ladda_bild.php" method="post" enctype="multipart/form-data">';			echo '<input type="file" name="file">';			echo '<input class="form-submit-button" type="submit" value="Ladda upp bild" name="submit">';			echo '</form></div>';						echo '<form action="change_profil.php" method="post" class="user-form">';			echo '<span class="user-info">Namn:</span>';			$query = "SELECT Fornamn FROM Anvandare WHERE ID=$id";			$query_run = $connect->query($query);			$query_result = mysqli_fetch_assoc($query_run);			echo '<input class="form-text-input" type="text" name="namn" placeholder="' . $query_result['Fornamn'] . '"> <br><br>';			echo '<span class="user-info">Efternamn:</span> ';			$query = "SELECT Efternamn FROM Anvandare WHERE ID=$id";			$query_run = $connect->query($query);			$query_result = mysqli_fetch_assoc($query_run);			echo '<input class="form-text-input" type="text" name="efternamn" placeholder="' . $query_result['Efternamn'] . '"> <br><br>';			$query = "SELECT Kon FROM Anvandare WHERE ID=$id";			$query_run = $connect->query($query);			$query_result = mysqli_fetch_assoc($query_run);			if ($query_result['Kon'] == "Man") {				echo '<span class="user-info">Kön:</span> <input class="form-radio-input" type="radio" name="gender" value="Man" Checked>Man					<input type="radio" name="gender" value="Kvinna">Kvinna<br><br>';			}			else {				echo '<span class="user-info">Kön:</span> <input class="form-radio-input" type="radio" name="gender" value="Man">Man					<input type="radio" name="gender" value="Kvinna" Checked>Kvinna<br><br>';			}			$query = "SELECT Lan FROM Anvandare WHERE ID=$id";			$query_run = $connect->query($query);			$query_result = mysqli_fetch_assoc($query_run);			echo '<span  class="user-info">Län:</span> <select class="form-select-input" name="lan">';			if ($query_result['Lan'] == "Stockholm") {				echo '<option value="Stockholm" selected="selected">Stockholm</option>						<option value="Skåne">Skåne</option>						<option value="Göteborg" >Göteborg</option>';			}			else if ($query_result['Lan'] == "Skåne") {				echo '<option value="Stockholm">Stockholm</option>						<option value="Skåne" selected="selected">Skåne</option>						<option value="Göteborg" >Göteborg</option>';			}			else if ($query_result['Lan'] == "Göteborg") {				echo '<option value="Stockholm">Stockholm</option>						<option value="Skåne">Skåne</option>						<option value="Göteborg" selected="selected">Göteborg</option>';			}			else {				echo '<option value="Stockholm">Stockholm</option>						<option value="Skåne">Skåne</option>						<option value="Göteborg" >Göteborg</option>';								}			echo '</select><br><br>';			echo '<span class="user-info">Aktivitetsgrad: </span>';			$query = "SELECT Aktivitetsgrad FROM Anvandare WHERE ID=$id";			$query_run = $connect->query($query);			$query_result = mysqli_fetch_assoc($query_run);			echo '<select class="form-select-input" name="aktivitet">';			switch ($query_result['Aktivitetsgrad']) {				case 1:					echo '<option value="1" selected="selected">1</option>						<option value="2">2</option>						<option value="3">3</option>						<option value="4">4</option>						<option value="5">5</option>';					break;				case 2:					echo '<option value="1">1</option>						<option value="2" selected="selected">2</option>						<option value="3">3</option>						<option value="4">4</option>						<option value="5">5</option>';					break;				case 3:					echo '<option value="1">1</option>						<option value="2">2</option>						<option value="3" selected="selected">3</option>						<option value="4">4</option>						<option value="5">5</option>';					break;				case 4:					echo '<option value="1">1</option>						<option value="2">2</option>						<option value="3">3</option>						<option value="4" selected="selected">4</option>						<option value="5">5</option>';					break;				case 5:					echo '<option value="1">1</option>						<option value="2">2</option>						<option value="3">3</option>						<option value="4">4</option>						<option value="5" selected="selected">5</option>';					break;			}			echo '</select><br><br>';			echo '<span class="user-info">E-mail: </span>';			$query = "SELECT Email FROM Anvandare WHERE ID=$id";			$query_run = $connect->query($query);			$query_result = mysqli_fetch_assoc($query_run);			echo ' <input class="form-text-input" type="text" name="email" placeholder="' .  $query_result['Email'] . '"> <br><br>';			echo '<input class="form-submit-button" type="submit" value="Submit" name="submit_text" >';			echo '</form>';						$admin = check_admin();			if ($admin) {				echo '<div class="user-admin">';				echo '<a href="change_news.php">Gör inlägg eller ändringar på första sidan</a><br>';				echo '<a href="change_user.php">Gör ändringar för användrakonton</a><br>';				echo '<a href="change_blogg.php">Gör inlägg eller ändringar på bloggen</a><br>';				echo '</div>';			}		}		else {			echo "Var vänlig logga in för att se din profil";		}	}	closeconnection($connect);}function check_admin () {	if ($_COOKIE['login'] != null) {		$connect = connecttodatabase();		$id = $_COOKIE['login'];		$query = "SELECT User_lvl FROM Anvandare WHERE ID=$id";		$query_result = mysqli_fetch_assoc($connect->query($query));		if ($query_result['User_lvl'] == 'A') {			return True;		}		else {			return False;		}		closeconnection($connect);	}	else {		return False;	}}function update_profil () {	$connect = connecttodatabase();	$notnull = array('Namn'=>null, 'Efternamn'=>null, 'Kon'=>null, 'Lan'=>null, 'Aktivitet'=>null, 'Email'=>null);	$changed = null;	$values = null;	if ($_POST['namn'] != null) {		$changed = "Fornamn";		$values = $_POST['namn'];	}	if ($_POST['efternamn'] != null) {		if ($changed == null) {			$changed = "Efternamn";			$values = $_POST['efternamn'];		}		else {			$changed = $changed . ", Efternamn";			$values = $values . ", " . $_POST['efternamn'];		}	}	if ($_POST['gender'] != null) {		if ($changed == null) {			$changed = "Kon";			$values = $_POST['gender'];		}		else {			$changed = $changed . ", Kon";			$values = $values . ", " . $_POST['gender'];		}	}	if ($_POST['aktivitet'] != null) {		if ($changed == null) {			$changed = "Aktivitetsgrad";			$values = $_POST['aktivitet'];		}		else {			$changed = $changed . ", Aktivitetsgrad";			$values = $values . ", " . $_POST['aktivitet'];		}	}	if ($_POST['email'] != null) {		if ($changed == null) {			$changed = "Email";			$values = $_POST['email'];		}		else {			$changed = $changed . ", Email";			$values = $values . ", " . $_POST['email'];		}	}	$query = "UPDATE Anvandare SET ";	closeconnection($connect);}function select_users() {	$connect = connecttodatabase();	if (check_admin()) {		$query = 'SELECT Nickname FROM Anvandare';		$query_run = $connect->query($query);		print '<form method="post" action="user_profil.php">';		print '<select name="slct">';		while($query_result = mysqli_fetch_assoc($query_run)) {			print '<option value="' . $query_result['Nickname'] . '">' . $query_result['Nickname'] . '</option>';		}		print '</select>';		print '<input type="submit" value="Gå Vidare">';		print '</form>';	}	else {		print "Du har inte behörighet för detta innehåll";	}	closeconnection($connect);}function get_profiler() {	$connect = connecttodatabase();	if (check_admin()) {		$user = $_POST['slct'];		$query = 'SELECT * FROM Anvandare WHERE Nickname="' . $user . '"';		$query_run = $connect->query($query);		$query_result = mysqli_fetch_assoc($query_run);		print '<form method="post" action="user_changed.php">';		print 'Användarnamn: ' . $query_result['Nickname'] . '<input type="text" name="Nickname"><br>';		print 'ID: ' . $query_result['ID'];		print 'Email: ' . $query_result['Email'] . '<input type="text" name="Email"><br>';		print 'Lösenord(Krypterat): ' . $query_result['Password'] . '<input type="text" name="Passwrod"><br>';		print 'Namn: ' . $query_result['Fornamn'] . '<input type="text" name="Fornamn"><br>';		print 'Efternamn: ' . $query_result['Efternamn'] . '<input type="text" name="Efternamn"><br>';		print 'Kön: ' . $query_result['Kon'] . '<input type="text" name="Kon"><br>';		print 'Län: ' . $query_result['Lan'] . '<input type="text" name="Lan"><br>';		print 'Användar nivå: ' . $query_result['User_lvl'] . '<input type="text" name="User_lvl"><br>';		print 'Aktivitetsgrad(1-5): ' . $query_result['Aktivitetsgrad'] . '<input type="text" name="Aktivitetsgrad"><br>';		print '<input type="submit" value="Submit">';		$_SESSION['user_id'] = $query_result['ID'];	}	else {		print "Du har inte behörighet för detta innehåll";	}	closeconnection($connect);}function change_profil() {	$connect = connecttodatabase();	if (check_admin()) {		$array = array(			"Nickname" => false,			"ID" => false,			"Email" => false,			"Fornamn" => false,			"Efternamn" => false,			"Kon" => false,			"Lan" => false,			"User_lvl" => false,			"Aktivitetsgrad" => false,		);		$names = "";		foreach($array as $x=>$x_value) {			if ($_POST[$x] != null) {				$x_value = true;				if ($names == "") {					$names = $x . "='" . $_POST[$x] . "'";				}				else {					$names = $names . ", " . $x . "='" . $_POST[$x] . "'";				}			}		}		if ($names != "") {			$password = false;			if($_POST['Password'] != null) {				$password = md5($_POST['Password']);			}			if ($array['Nickname'] || $array['Email']) {				$query = 'SELECT Nickname, Email FROM Anvandare';				$query_run = $connect->query($query);				$wrong_mail = false;				while ($query_result = mysqli_fetch_assoc($query_run)) {					if ($query_result['Email'] == $_POST['EMAIL'] || $query_result['Nickname'] == $_POST['Nickname']) {						$wrong_mail = true;					}				}				if (!$wrong_mail) {					if ($password) {						$query = "UPDATE Anvandare SET " . $names . ", Password='" . $password . "' WHERE ID=" . $_SESSION['user_id'];					} else {						$query = 'UPDATE Anvandare SET ' . $names . 'WHERE ID=' . $_SESSION['user_id'];					}					$query_run = $connect->query($query);					$andringar = "";					foreach($array as $x=>$x_value) {						if ($x_value) {							$andringar = $andringar . $x . ' ';						}					}					print "Ändringar gjordes på " . $andringar . "för kontot med id " . $_SESSION['user_id'];					print $names;				}				else {					print "Användarnamnet eller mailaddressen används redan";				}			}			else {				if ($password) {					$query = "UPDATE Anvandare SET " . $names . ", Password='" . $password . "' WHERE ID=" . $_SESSION['user_id'];				} else {					$query = 'UPDATE Anvandare SET ' . $names . 'WHERE ID=' . $_SESSION['user_id'];				}				$query_run = $connect->query($query);				$andringar = "";				foreach($array as $x=>$x_value) {					if ($x_value) {						$andringar = $andringar . $x . ' ';					}				}				print "Ändringar gjordes på 2 " . $andringar . "för kontot med id " . $_SESSION['user_id'];				print $names;			}		}		else {			print "Inga ändringar gjordes.";		}		}	else {		print "Du har inte behörighet för detta innehåll";	}	closeconnection($connect);}function load_activity () {	$usr_id = $_GET['skapare'];	if (isset($_COOKIE['login']) && $_COOKIE['login'] != null) {		if ($_GET['operation'] == "change") {			if ($usr_id == $_COOKIE['login']) {				$event_id = $_GET['evt'];				$connect = connecttodatabase();				$query = "SELECT * FROM Events WHERE ID=" . $event_id;				$mysql_run = $connect->query($query);				if (!$mysql_run) {					echo 'error';				}				$query_result = mysqli_fetch_assoc($mysql_run);				closeconnection($connect);				$time = strtotime($query_result['Date']);				echo '<form action="skapa_event.php?operation=change&evt=' . $event_id . '" method="post">';				echo 'Aktivitetens Namn:<Input type="text" name="namn" value="' . $query_result['Namn'] . '"><br>';				echo 'Aktivitetens Plats:<Input type="text" name="plats" value="' . $query_result['Plats'] . '"><br>';;				echo 'Aktivitetens Datum:<select name="year">';				echo '<option value="' . date('Y', $time - (365*24*60*60)) . '">' . date('Y', $time- (365*24*60*60)) . '</option>';				echo '<option value="' . date('Y', $time) . '" selected>' . date('Y', $time) . '</option>';				echo '<option value="' . date('Y', $time + (365*24*60*60)) . '">' . date('Y', $time + (365*24*60*60)) . '</option>';				echo '<option value="' . date('Y', $time + (2*365*24*60*60)) . '">' . date('Y', $time + (2*365*24*60*60)) . '</option>';				echo '</select>';				echo '<select name="month">';				for($i = 1; $i<= 12; $i++) {					if ($i == date('n', $time)) {						echo '<option value="' . $i . '" selected>' . $i . '</option>';					} else {						echo '<option value="' . $i . '">' . $i . '</option>';					}				}				echo '</select>';				echo '<select name="day">';				for ($i = 1; $i <= 31; $i++) {					if ($i == date('j', $time)) {						echo '<option value="' . $i . '" selected>' . $i . '</option>';					} else {						echo '<option value="' . $i . '">' . $i . '</option>';					}				}				echo '</select>';				echo '<select name="time">';				$hour = "0";				$min = "00";				while ($hour != "24") {					echo '<option value="';					echo $hour . ':';					echo $min;					echo '"';					if ($hour == date('G', $time) && $min == date('i', $time)) {						echo 'selected';					}					echo '>' . $hour;					echo ':';					echo $min;					echo '</option>';					if ($min == "00") {						$min += 30;					}					else {						$min = "00";						$hour++;					}				}				echo '</select><br>';				echo 'Aktivitetens Synlighet: ';				if ($query_result['Synlighet'] == 'A') {					echo '<input type="radio" name="visibility" value="A" checked>Offentlig';					echo '<input type="radio" name="visibility" value="F">Vänner<br>';				} else {					echo '<input type="radio" name="visibility" value="A">Offentlig';					echo '<input type="radio" name="visibility" value="F" checked>Vänner<br>';				}				echo '<input type="submit" value="submit">';				echo '</form>';			} else {				Echo 'Du har inte behörighet för att se sidans innehåll';			}		} else if ($_GET['operation'] == "skapa" || !isset($_GET['operation'])) {			Echo '<form action="skapa_event.php?operation=skapa" method="post">';			echo 'Aktivitetens Namn:<input type="text" name="namn"><br>';			Echo 'Aktivitetens Plats:<input type="text" name="plats"><br>';			echo 'Aktivitetens Datum: ';			get_date();			echo '<br>';			echo 'Aktivitetens Tidpunkt:<select name="tid">';			getoptions();			echo '</select><br>';			echo 'Aktivitetens Synlighet: <input type="radio" name="visibility" value="alla">Offentlig';			echo '<input type="radio" name="visibility" value="friends">Vänner<br>';			echo '<input type="submit" value="submit">';			echo '</form>';		}	} else {		echo 'Du måste logga in för att ha åtkosmt till denna sida.';	}}function sok_calendar() {	if (isset($_POST['fras']) || isset($_POST['skapare'])  || isset($_POST['datumf']) || isset($_POST['datumt']) || isset($_POST['flr']) || isset($_POST['mindr'])) {		$connect = connecttodatabase();		$query = "";		$tick = 0;		$bool = false;		if ($_POST['flr'] != "" || $_POST['mindr'] != "") {			$query = "SELECT Events.Namn, Events.ID, COUNT(Status.ID_Evt) AS anm FROM Events INNER JOIN Status ON Events.ID=Status.ID_Evt ";			$bool = true;		} else {			$query = "SELECT * FROM Events WHERE ";		}		if ($_POST['fras'] != null) {			if ($bool) {				$query .= "WHERE ";				$bool = false;			}			$query .= "(Namn LIKE '%" . $_POST['fras'] . "%' OR Plats LIKE '%" . $_POST['fras'] . "%')";			$tick += 1;		}		if ($_POST['skapare'] != null) {			$skapare_query = "SELECT ID FROM Anvandare WHERE LOWER(Nickname) LIKE '%" . strtolower($_POST['skapare'] . "%'");			$skapare_result = mysqli_fetch_assoc($connect->query($skapare_query));			if ($tick >= 1) {				$query .= " AND ";			} else if ($bool) {				$query .= "WHERE ";				$bool = false;			}			$query .= "(Skapare=" . $skapare_result['ID'] . ")";			$tick += 1;		}		if ($_POST['sport'] != null) {			if ($tick >= 1 && $_POST['sport'] != "alla") {				$query .= " AND ";				$query .= "(Sport='" . $_POST['sport'] . "')";				$tick += 1;			}		}		if ($_POST['datumf'] != null || $_POST['datumt'] != null) {			if ($tick >= 1) {				$query .= " AND ";			} else if ($bool) {				$query .= "WHERE ";				$bool = false;			}			if ($_POST['datumf'] != null && $_POST['datumt'] != null) {				$query .= "(Date BETWEEN '" . $_POST['datumf'] . "' AND '" . $_POST['datumt'] . "')";			} else if ($_POST['datumf'] != null && $_POST['datumt'] == null) {				$query .= "(Date >= '" . $_POST['datumf'] . "')";			} else if ($_POST['datumf'] == null && $_POST['datumt'] != null) {				$query .= "(Date <= '" . $_POST['datumt'] . "')";			}			$tick += 1;		}		if ($_POST['flr'] != null) {			$query .= " GROUP BY Events.ID";			$query .= " HAVING (anm >= " . $_POST['flr'] . ")";			$tick = 20;		}		if ($_POST['mindr'] != null) {			if ($tick == 20) {				$query .= " AND ";				$query .= "(`anm` <= " . $_POST['mindr'] . ")";			} else {				$query .= " GROUP BY Events.ID";				$query .= " HAVING (anm <= " . $_POST['mindr'] . ")";			}			$tick += 1;		}		$query_run = $connect->query($query);		while($query_result = mysqli_fetch_assoc($query_run)) {			print '<div id="' . $query_result['ID'] . '" class="aktivitet">';			print $query_result['Namn'];			print '</div>';		}		closeconnection($connect);	} else {		print '<p class="empty_result">Inga aktiviteter hittades</p>';	}}function set_notis ($connect, $anv, $id, $type, $text) {	$query = "INSERT INTO Notifikationer (Anvandare_ID, Not_ID, Status, Type, Text) VALUES(" . $anv . ", " . $id . ", 1, " . $type . ", '" . $text . "')";	if($connect->query($query)) {	} else {		print mysqli_error($connect);	}}function get_har_notifikation ($connect, $anv, $id, $type, $level) {	if ($level == 3) {		$query = "SELECT Anv_ID FROM Har_Notifikation WHERE (Anv_ID=" . $anv . " AND Evt_ID=" . $id . " AND Type=" . $type . " AND Level=" . $level . ")";	} else if ($level == 2) {		$query = "SELECT Anv_ID FROM Har_Notifikation WHERE (Anv_ID=" . $anv . " AND Evt_ID=" . $id . " AND Type=" . $type . " AND (Level=" . $level . " OR Level=3))";	} else {		$query = "SELECT Anv_ID FROM Har_Notifikation WHERE (Anv_ID=" . $anv . " AND Evt_ID=" . $id . " AND Type=" . $type . " AND (Level=" . $level . " OR Level=3 OR Level=2))";	}	$query_run = $connect->query($query);	return $query_run;}function set_har_notis ($connect, $anv, $id, $type, $level) {	$query = "REPLACE INTO Har_Notifikation (Anv_ID, Evt_ID, Type, Level) VALUES($anv, $id, $type, $level)";	$connect->query($query);}function send_notis ($connect, $anv, $id, $type, $level, $text) {	$query = get_har_notifikation($connect, $anv, $id, $type, $level);	while($result = mysqli_fetch_assoc($query)) {		set_notis($connect, $result['Anv_ID'], $id, $type, $text);	}}function create_notis_center () {	if (checklogin()) {		print '<div class="notis_center">';			print '<div class="button"><div class="arrow">></div></div>';			print '<button class="notis active" id="meddelanden">Meddelanden</button>';			print '<button class="notis" id="notis">Notiser</button>';						print '<div class="notis_contain">';				print '<div class="meddelanden">';					print '<div class="meddelanden_display"></div>';				print '</div>';				print '<div class="lista">';					print '<div class="lista_display"></div>';				print '</div>';				print '<div class="skriv">';					print '<form action="javascript:send_msg();" class="msg">						<textarea class="msg" name="msg">Skriv ett meddelande</textarea>						<input type="Submit" value="Skicka" class="skicka">					</form>';				print '</div>';			print "</div>";		print '</div>';	}}?>